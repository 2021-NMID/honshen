<!DOCTYPE HTML>
<html>
    <head>
    	<meta charset="UTF-8">
    	<title>Moods</title>
        <link rel="stylesheet" type="text/css" href="mood.css">
        <script>
            //注册跳转
            function regis(){
                window.location.href='regis.html';
            }
            //切换登陆方式
            var count = 0;
            function change_log(){
                
                if(count%2==1){
                    document.getElementById("change_log").innerHTML='密码登录';
                }else{
                    document.getElementById("change_log").innerHTML='验证码登录';
                }
                count++;
                change_info(document.getElementById("change_log").innerHTML);
            }
            function change_info(info){
                if(info=='密码登录'){
                    document.getElementById("ps").style.display='none';
                    document.getElementById("ph").style.display='block';
                }else{
                    document.getElementById("ps").style.display='block';
                    document.getElementById("ph").style.display='none';
                }
            }

            //获取验证码
            function yanzhengma(){
                var email = document.getElementById('em').value;
                console.log(email);

                let xhr = new XMLHttpRequest();
                let server = 'http://47.98.192.167:8800/smsXxs?phone='+email;
                xhr.open('GET',server);
                xhr.send();
                xhr.onreadystatechange = function(){
                    if(xhr.readyState === 4){
                        if(xhr.status === 200){
                            alert('验证码已发送');
                        }
                    }
                }
            }

            //验证邮箱格式或是否为空
            function email_check(){
                var str = document.getElementById('em').value;
                var re = /^(\w-*\.*)+@(\w-?)+(\.\w{2,})+$/
                if(re.test(str)){
                }else if(str==""){
                    alert("邮箱为空");
                }else{
                    alert("邮箱格式错误");
                }
            }

            //验证码登录
            function login(){
                if(count%2==0){
                    let ph = document.getElementById('em').value;
                    let yzm = document.getElementById('yzm').value;
                    console.log(ph+' '+yzm);
                    let xhr = new XMLHttpRequest();
                    let server = 'http://47.98.192.167:8800/users/load?pin='+yzm+'&tel='+ph;
                    xhr.open('POST',server);
                    xhr.send();
                    xhr.onreadystatechange = function(){
                        if(xhr.readyState === 4){
                            if(xhr.status === 200){
                                console.log(xhr.response);
                                var obj = JSON.parse(xhr.response);
                                console.log(obj.data['msg']);
                                if(obj.data['msg'] == '用户验证码输入错误'){
                                    alert('验证码错误')
                                }else if(obj.data['msg'] == '用户验证码输入超时'){
                                    alert('用户验证码输入超时')
                                }
                                else{
                                    alert('登陆成功')
                                }
                            }
                        }
                    }
                }
                //密码登录
                if(count%2==1){
                    let ph = document.getElementById('em').value;
                    let mm = document.getElementById('mm').value;
                    console.log(ph+' '+mm);
                    let xhr = new XMLHttpRequest();
                    let server = 'http://47.98.192.167:8800/users/load?psw='+mm+'&tel='+ph;
                    xhr.open('POST',server);
                    xhr.send();
                    xhr.onreadystatechange = function(){
                        if(xhr.readyState === 4){
                            if(xhr.status === 200){
                                console.log(xhr.response);
                                var obj = JSON.parse(xhr.response);
                                console.log(obj.data['msg']);
                                if(obj.data['msg'] == '账户密码错误'){
                                    alert('密码错误')
                                }else{
                                    alert('登陆成功')
                                }
                            }
                        }
                    }
                }
            }
        </script>
    </head>
    <body>
        <div class="content">
            <div class="left">
                <img class="login_img" src="./image/登录背景图.png">
            </div>
            <div class="right">
                    <div class="log">
                        Moods
                    </div>
                    <div class="welcome">
                        欢迎登录Moods
                    </div>
                    <div class="change">
                        <button id="change_log" class="ch" onclick="change_log()">密码登录</button>
                    </div>

                    <div class="info">
                        <div class="input">
                            <input id='em' placeholder="输入邮箱" type="text" onblur="email_check()">
                        </div>
                        <div id="ps" class="input" style="display: none;">
                            <input id='mm' placeholder="输入登录密码" type="text">
                        </div>
                        <div class="ph" id="ph" style="display: block;">
                            <input id='yzm' class="input_send" placeholder="输入验证码" type="text" style="width: 180px;">
                            <input id='get_yzm' class="send_yanzhengma" type="button" value="获取验证码" onclick="yanzhengma()">
                        </div>
                        
                        <button class="sub" onclick="login()">登录</button>  

                        <p style="color: #69c6d6;" onclick="regis()">注册</p>
                    </div>
            </div>
        </div>
    </body>
</html>